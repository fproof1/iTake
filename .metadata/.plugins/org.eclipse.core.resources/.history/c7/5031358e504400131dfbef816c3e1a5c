/**
 * 
 */
package com.example.itake;

import java.io.IOException;

import android.app.Activity;
import android.app.AlertDialog;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.ContextWrapper;
import android.content.DialogInterface;
import android.content.Intent;
import android.media.AudioManager;
import android.media.MediaPlayer;
import android.media.RingtoneManager;
import android.net.Uri;
import android.os.Bundle;
import android.view.MotionEvent;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.View.OnTouchListener;
import android.view.Window;
import android.view.WindowManager;
import android.widget.Button;
import android.widget.Toast;

/**
 * @author Wolfpack16 (R. Alex Kane)
 *
 */
public class AlarmReceiver extends BroadcastReceiver 
{
	//private MediaPlayer mMediaPlayer; 
	
	@Override
	public void onReceive(Context k1, Intent k2) 
    {
		// TODO Auto-generated method stub
		//Toast.makeText(k1, "Alarm received!", Toast.LENGTH_LONG).show();
        AlertDialog.Builder alertDialogBuilder = new AlertDialog.Builder(k1.getApplicationContext());
        alertDialogBuilder.setTitle("Medicine Alert");
        alertDialogBuilder.setMessage("Insert Medication Name Here");
        alertDialogBuilder.show();
        
        /*alertDialogBuilder.setNegativeButton("Taken", new DialogInterface.OnClickListener() 
        {                   
        	public void onClick(DialogInterface dialog, int which) 
        	{
                mMediaPlayer.stop();
            } //end onClick.
        }); // end alertDialog.setButton.
        
        alertDialogBuilder.setPositiveButton("Remind Me Later", new DialogInterface.OnClickListener() 
        {                   
        	public void onClick(DialogInterface dialog, int which) 
        	{
                mMediaPlayer.stop();
            } //end onClick.
        }); // end alertDialog.setButton.
        alertDialogBuilder.show();  
      //  Button theButton = alertDialogBuilder.getButton(DialogInterface.BUTTON_POSITIVE);
      //  theButton.setOnClickListener(new OnClickListener(alertDialogBuilder));
     //   Button stopAlarm = (Button) findViewById(R.id.stopAlarm);
      //  stopAlarm.setOnTouchListener(new OnTouchListener() 
      //  {
      //      public boolean onTouch(View arg0, MotionEvent arg1) 
       //     {
        //        mMediaPlayer.stop();
         //       finish();
         //       return false;
         //   }
       // });
        playSound(k1, getAlarmUri());
    }

	private void playSound(Context alarmReceiver, Uri alert) 
    {
        mMediaPlayer = new MediaPlayer();
        try
        {
            mMediaPlayer.setDataSource(alarmReceiver, alert);
            final AudioManager audioManager = (AudioManager) alarmReceiver
                    .getSystemService(Context.AUDIO_SERVICE);
            if (audioManager.getStreamVolume(AudioManager.STREAM_ALARM) != 0) 
            {
                mMediaPlayer.setAudioStreamType(AudioManager.STREAM_ALARM);
                mMediaPlayer.setLooping(true);
                mMediaPlayer.prepare();
                mMediaPlayer.start();
            }
        } 
        catch (IOException e) 
        {
            System.out.println("OOPS");
        }
    }

    //Get an alarm sound. Try for an alarm. If none set, try notification, 
    //Otherwise, ringtone.
    private Uri getAlarmUri() 
    {
        Uri alert = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_ALARM);
        if (alert == null) 
        {
            alert = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);
            if (alert == null) 
            {
                alert = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_RINGTONE);
            }
        }
        return alert;*/
    }
}